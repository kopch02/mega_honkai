Mega-Honkai
===
Подсчёт прыжков и статистика по ним для игры Honkai Star Rail
---
___
Сайт работает по адресу [mega-honkai.ru](https://mega-honkai.ru/)
___
Сборка и запуск
===
Для запуска веб приложения вам потребуется открыть файл [db_session.py](https://github.com/kopch02/mega_honkai/blob/master/data/db_session.py)
и в строке

```Python
    conn_str = f"postgresql+psycopg2://postgres:password@localhost/mega_honkai"
```
внести следуюшие изменения:
```Python
    conn_str = f"ваша_бд+модуль_для_работы://имя_пользователя_бд:пароль@localhost/название_бд"
```
Далее вам остаётся только запустить файл [main.py](https://github.com/kopch02/mega_honkai/blob/master/main.py)
>python main.py

>python3.10 main.py
___
Описание Базы Данных
===
В БД всего 5 таблиц:
- items
    - содержит информацию о всех существующих в игре предметах

    | id | name | rank | type |
    |---------|:------:|:-------:|:-----|
    |уникальный id|имя|редкость|тип|

- users
    - содержит информацию о пользователях

    | id | name | email | all_jumps | garant_5 | garant_4 | hashed_password |
    |------|:-----:|:-----:|:-----:|:----:|:----:|:---|
    |уникальный id|имя пользователя|Почта|Общее количесво прыжков| Сколько прошло с прошлого 5*|Сколько прошло с прошлого 4*| Хешированный пароль|
    ||||выглядит как строка разделитель 0;0;0|выглядит как строка разделитель 0;0;0|выглядит как строка разделитель 0;0;0|
    ||||Каждое число отвечает за свой баннер|Каждое число отвечает за свой баннер|Каждое число отвечает за свой баннер|

- Jump_event, Jump_weapon, Jump_standart
    - В игре есть 3 баннера, откуда можно получать предметы, баннер события, оружия и стандартный, для каждого из них есть своя таблица, все они выглядят так:

    | id | user_id | item_id | time |
    |--------|:------:|:-------:|:-----|
    |уникальный id|id пользователя|id предмета|время получения|
___
Описание работы
===

- Получение информации от игры:
    - для этого используется специальный [gist](https://gist.github.com/kopch02/a98fe2107e7897672d05a1bd25b20e8a), который получает список всех совершённых прыжков за    полследние пол года.
- Далее пользователю нужно самостоятельно выполнить команду в PowerShell для копирования специальной ссылки с инфомармацией о прыжках
``` 
Invoke-Expression (New-Object Net.WebClient).DownloadString("https://gist.githubusercontent.com/kopch02/a98fe2107e7897672d05a1bd25b20e8a/raw/bdf44928a82825db5d417392d987566895ac820f/gistfile1.txt")
```
- Полученная ссылка уже преобразуется в сами прыжки и включает в себя слудующую информацию:
    - Имя предмета
    - Редкость
    - Время выпадения
    - id предмета
    - uid - уникальный id игрока, совершивший прыжок
    - тип предмета (персонаж или световой конус (оружее))
- Полученные данные фильтруются и берутся только те, которые ранее не было добавленны в БД
    - фильтрация происходит путём сравнения времени получения предметов
- Из полученного списка предметов отбираются те предметы, которые ещё не были внесены в БД
    - Это может быть новый персонаж добавленный в игру или другой предмет, если ранее о нём не было изветно, то он фиксируется в БД
- После фиксации новых предметов, весь список добавляется в БД к общему списку прыжков, с указанием:
    - Пользователя
    - ID предмет
    - Временем получения
    - Номером прыжка конкретного пользователя
    - Для предметов редкостью 4 или 5 звёзд так же записывается сколько прошло прыжков с прошлого предмета такой же редкости
- Для пользователя добавившего прыжки обновляются:
    - Общее количество прыжков в каждом баннере
    - Количество прыжков с прошлого предмета редкость 4 и 5 звёзд
- Вся полученная информация отображается пользователю
___
API
===
>/api/v1/users - Получение всех пользователей

>/api/v1/users/<int:users_id> -Получение конкретного пользователя

>/api/v1/items - Получение всех внутриигровых предметов

>/api/v1/items/<int:item_id> - Получение одного предмета